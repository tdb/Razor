d-i debian-installer/language string en_GB:en
d-i pkgsel/language-pack-patterns string
pkgsel pkgsel/language-pack-patterns string
d-i base-installer/kernel/override-image string linux-server
tasksel tasksel/force-tasks string server
d-i console-setup/ask_detect boolean false
d-i keyboard-configuration/modelcode string pc105
d-i keyboard-configuration/layoutcode string gb
d-i ethdetect/prompt_missing_firmware boolean false
d-i netcfg/choose_interface select auto
d-i netcfg/get_hostname string <%= hostname %>
d-i netcfg/get_domain string kent.ac.uk
d-i netcfg/no_default_route boolean true
d-i mirror/protocol string http
d-i mirror/country string manual
#d-i mirror/http/hostname string <%= config.image_svc_host %>:<%= config.image_svc_port %>
#d-i mirror/http/directory string /razor/image/os/<%= @image_uuid %>
d-i mirror/http/hostname string gb.archive.ubuntu.com
d-i mirror/http/directory string /ubuntu/
d-i mirror/http/proxy string
d-i clock-setup/utc boolean true
d-i time/zone string Europe/London
d-i clock-setup/ntp boolean true
d-i partman-auto/disk string <%= @root_disk ? @root_disk : "/dev/sda" %>
d-i partman-auto/method string regular
d-i partman-lvm/device_remove_lvm boolean true
d-i partman-md/device_remove_md boolean true
d-i partman-auto/expert_recipe string \
	root :: \
		8192 8241 16384 linux-swap \
			$primary{ } \
			method{ swap } format{ } \
		. \
		16384 16386 -1 ext4 \
			$primary{ } $bootable{ } \
			method{ format } format{ } \
			use_filesystem{ } filesystem{ ext4 } \
			mountpoint{ / } \
		. \
		8192 8241 16384 ext4 \
			$primary{ } \
			method{ format } format{ } \
			use_filesystem{ } filesystem{ ext4 } \
			mountpoint{ /var } \
		.
d-i partman-auto/choose_recipe select root
d-i partman-auto/purge_lvm_from_device boolean true
d-i partman/default_filesystem string ext4
d-i partman-lvm/confirm boolean true
d-i partman-lvm/confirm_nooverwrite boolean true
d-i partman-partitioning/confirm_write_new_label boolean true
d-i partman/choose_partition select finish
d-i partman/confirm boolean true
d-i partman/confirm_nooverwrite boolean true
d-i partman-md/confirm boolean true
d-i partman-md/confirm_nooverwrite boolean true
d-i passwd/root-login boolean true
d-i passwd/make-user boolean false
d-i passwd/root-password password <%= @root_password %>
d-i passwd/root-password-again password <%= @root_password %>
d-i passwd/user-fullname string User
d-i passwd/username string user
d-i passwd/user-password password insecure
d-i passwd/user-password-again password insecure
d-i user-setup/allow-password-weak boolean true
d-i apt-setup/restricted boolean true
d-i pkgsel/include string curl openssh-server puppet
d-i grub-installer/only_debian boolean true
d-i grub-installer/with_other_os boolean true
d-i grub-installer/bootdev string <%= @root_disk ? @root_disk : "/dev/sda" %>
d-i finish-install/reboot_in_progress note
#Our callbacks
# The hooks available are listed here:
# http://d-i.alioth.debian.org/doc/internals/apb.html#ap-hooks-general
# This pulls a new adduser.conf in to place before the Operating System
# gets installed. The adduser package is happy if the file already exists
# and doesn't overwrite it. The only downside is that this copy could drift
# out of date in future OS versions.
# The range 99900-99999 is reserved in admin for local accounts.
d-i preseed/early_command string \
wget <%= api_svc_uri %>/policy/callback/<%= policy_uuid %>/preseed/start; \
wget <%= api_svc_uri %>/policy/callback/<%= policy_uuid %>/preseed/adduserconf -O /tmp/adduser.conf; \
echo "cp /tmp/adduser.conf /target/etc/adduser.conf" > /usr/lib/base-installer.d/00systemuids; \
chmod 755 /usr/lib/base-installer.d/00systemuids
# This is an alternative approach that modifies the existing file later on in
# the install process, but misses the first couple of users/groups.
#echo "sed -e 's/^FIRST_SYSTEM_UID=.*$/FIRST_SYSTEM_UID=99000/' -e 's/^LAST_SYSTEM_UID=.*$/LAST_SYSTEM_UID=99999/' -e 's/^FIRST_SYSTEM_GID=.*$/FIRST_SYSTEM_GID=99000/' -e 's/^LAST_SYSTEM_GID=.*$/LAST_SYSTEM_GID=99999/' /target/etc/adduser.conf > /target/etc/adduser.conf.new && mv /target/etc/adduser.conf.new /target/etc/adduser.conf" > /usr/lib/post-base-installer.d/00systemuids; \
#chmod 755 /usr/lib/post-base-installer.d/00systemuids
d-i preseed/late_command string  \
wget <%= api_svc_uri %>/policy/callback/<%= policy_uuid %>/preseed/end; \
wget <%= api_svc_uri %>/policy/callback/<%= policy_uuid %>/postinstall/inject -O /target/usr/local/bin/razor_postinstall.sh;  \
sed -i '/^exit 0$/d' /target/etc/rc.local;  \
echo bash /usr/local/bin/razor_postinstall.sh >> /target/etc/rc.local; \
echo exit 0 >> /target/etc/rc.local;  \
chmod +x /target/usr/local/bin/razor_postinstall.sh; \
sed -i 's/PermitRootLogin without-password/PermitRootLogin yes/' /target/etc/ssh/sshd_config
